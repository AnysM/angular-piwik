"use strict";angular.module("pxmPiwik",[]),angular.module("pxmPiwik").directive("pxmPiwik",["$piwik",function(a){return{link:function(b){a.addTracker(b.site,b.url)},restrict:"E",scope:{site:"=?",url:"@?"}}}]),angular.module("pxmPiwik").config(["$provide",function(a){function b(){var a="json",b=1,c="en",d="anonymous",e="http://demo.piwik.org/",f="http://demo.piwik.org/",g="http://demo.piwik.org/";this.setFormat=function(b){a=b},this.setId=function(a){b=a},this.setLanguage=function(a){c=a},this.setToken=function(a){d=a},this.setUrl=function(a){e=a,f=a,g=a},this.setUrlApi=function(a){e=a},this.setUrlTracker=function(a){f=a},this.setUrlWidget=function(a){g=a},this.$get=["$document","$http","$window",function(h,i,j){var k={},l={};return k.addTracker=function(a,c){var d=h[0].createElement("script"),e=h[0].getElementsByTagName("script")[0];d.async=!0,d.defer=!0,d.src=(c||f)+"piwik.js",d.type="application/javascript",e.parentNode.insertBefore(d,e),k.track("trackPageView"),k.track("enableLinkTracking"),k.track("setTrackerUrl",[(c||f)+"piwik.php"]),k.track("setSiteId",[a||b])},k.call=function(){var a;if(a=1===arguments.length&&angular.isArray(arguments[0][0])?arguments[0]:2===arguments.length&&angular.isString(arguments[0])?[[arguments[0],arguments[1]]]:Array.prototype.slice.call(arguments),!(a.length<1)){if(1===a.length)return l.apiCall(l.methodParams(a[0]));var b={method:"API.getBulkRequest",urls:[]};return angular.forEach(a,function(a){this.push(l.paramSerializer(l.methodParams(a)))},b.urls),l.apiCall(b)}},k.track=function(a,b){if(b=b||[],angular.isString(a)&&angular.isArray(b)){var c=-1;b.unshift(a),j._paq=j._paq||[],angular.forEach(j._paq,function(a,d){return a[0]===b[0]?void(c=d):void 0}),-1===c?j._paq.push(b):j._paq[c]=b}},k.widget=function(a,e){return l.buildUrl(g,angular.extend({action:"iframe",actionToWidgetize:a.split(".")[1],disableLink:1,idSite:b,language:c,module:"Widgetize",moduleToWidgetize:a.split(".")[0],token_auth:d,widget:1},e))},l.apiCall=function(d){return i.get(l.buildUrl(e,angular.extend({format:a,idSite:b,language:c,module:"API"},d)))},l.buildUrl=function(a,b){return a+(-1===a.indexOf("?")?"?":"&")+l.paramSerializer(b)},l.methodParams=function(a){return angular.extend({method:a[0],token_auth:d},a[1])},l.paramSerializer=function(a){if(!a)return"";var b=[];return angular.forEach(a,function(a,c){return null===a||angular.isUndefined(a)?void 0:angular.isArray(a)||angular.isObject(a)?void angular.forEach(a,function(a,d){b.push(encodeURIComponent(c+"["+d+"]")+"="+encodeURIComponent(l.serializeValue(a)))}):void b.push(encodeURIComponent(c)+"="+encodeURIComponent(l.serializeValue(a)))}),b.length>0?b.join("&"):""},l.serializeValue=function(a){return angular.isObject(a)?angular.isDate(a)?a.toISOString():angular.toJson(a):a},k}]}a.provider("$piwik",b)}]);